{% extends 'store/dashboard.html' %}
{% load static %}

{% block content %}

<div class="container-fluid py-4">

    <!-- Header + Add Button -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="mb-0 fw-semibold text-dark">Store Management</h4>
        <a href="{% url 'store_registration' %}" class="btn btn-primary btn-lg shadow-sm">
            <i class="fas fa-plus me-2"></i>Add New Store
        </a>
    </div>

    <div class="card shadow border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover table-bordered align-middle mb-0 small">
                    <thead class="bg-dark text-white text-center">
                        <tr>
                            <th class="py-3">ID</th>
                            <th class="py-3">Store Name</th>
                            <th class="py-3">Owner</th>
                            <th class="py-3">Email</th>
                            <th class="py-3">Phone</th>
                            <th class="py-3">Type</th>
                            <th class="py-3">City</th>
                            <th class="py-3">Sub City</th>
                            <th class="py-3">Address</th>
                            <th class="py-3">Description</th>

                            <!-- Services -->
                            <th class="py-3">Rental</th>
                            <th class="py-3">Sale</th>
                            <th class="py-3">Delivery</th>
                            <th class="py-3">Del. Fee</th>
                            <th class="py-3">Bike</th>
                            <th class="py-3">Car</th>
                            <th class="py-3">Pickup</th>

                            <!-- Working Days - grouped visually -->
                            <th colspan="4" class="bg-secondary text-white">Monday</th>
                            <th colspan="4" class="bg-secondary text-white">Tuesday</th>
                            <th colspan="4" class="bg-secondary text-white">Wednesday</th>
                            <th colspan="4" class="bg-secondary text-white">Thursday</th>
                            <th colspan="4" class="bg-secondary text-white">Friday</th>
                            <th colspan="4" class="bg-secondary text-white">Saturday</th>
                            <th colspan="4" class="bg-secondary text-white">Sunday</th>

                            <!-- Rental Terms -->
                            <th class="py-3">Period</th>
                            <th class="py-3">Price</th>
                            <th class="py-3">Late Fee</th>
                            <th class="py-3">Deposit</th>
                            <th class="py-3">Max Books</th>
                            <th class="py-3">Discount</th>
                            <th class="py-3">Payments</th>
                            <th class="py-3">Terms</th>

                            <th class="py-3">Actions</th>
                        </tr>
                        <!-- Second header row for day details -->
                        <tr class="bg-dark text-white text-center small fw-normal">
                            <th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th>
                            <!-- Services -->
                            <th></th><th></th><th></th><th></th><th></th><th></th><th></th>
                            <!-- Monday -->
                            <th>Open</th>
                            <th>Open Time</th>
                            <th>Close Time</th>
                            <th>Closed</th>
                            <!-- Tuesday -->
                            <th>Open</th>
                            <th>Open Time</th>
                            <th>Close Time</th>
                            <th>Closed</th>
                            <!-- Wednesday -->
                            <th>Open</th>
                            <th>Open Time</th>
                            <th>Close Time</th>
                            <th>Closed</th>
                            <!-- Thursday -->
                            <th>Open</th>
                            <th>Open Time</th>
                            <th>Close Time</th>
                            <th>Closed</th>
                            <!-- Friday -->
                            <th>Open</th>
                            <th>Open Time</th>
                            <th>Close Time</th>
                            <th>Closed</th>
                            <!-- Saturday -->
                            <th>Open</th>
                            <th>Open Time</th>
                            <th>Close Time</th>
                            <th>Closed</th>
                            <!-- Sunday -->
                            <th>Open</th>
                            <th>Open Time</th>
                            <th>Close Time</th>
                            <th>Closed</th>
                            <!-- Rental -->
                            <th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th>
                            <th></th>
                        </tr>
                    </thead>

                    <tbody class="text-center">
                        {% for store in stores %}
                        <tr>
                            <td class="fw-bold text-muted">{{ store.id }}</td>
                            <td class="fw-semibold">{{ store.store_name }}</td>
                            <td>{{ store.owner_full_name }}</td>
                            <td class="text-nowrap">{{ store.email }}</td>
                            <td>{{ store.phone }}</td>
                            <td>{{ store.store_type }}</td>
                            <td>{{ store.city }}</td>
                            <td>{{ store.sub_city }}</td>
                            <td class="text-start">{{ store.address }}</td>
                            <td class="text-start text-truncate" style="max-width: 180px;" title="{{ store.store_description }}">
                                {{ store.store_description|truncatewords:8|default:"—" }}
                            </td>

                            <td><span class="badge bg-success-subtle text-success">{{ store.offers_rental|yesno:"Yes,No" }}</span></td>
                            <td><span class="badge bg-success-subtle text-success">{{ store.offers_sale|yesno:"Yes,No" }}</span></td>
                            <td><span class="badge bg-info-subtle text-info">{{ store.offers_delivery|yesno:"Yes,No" }}</span></td>
                            <td class="fw-medium">${{ store.delivery_fee|default:"0.00" }}</td>
                            <td>{{ store.delivery_bike|yesno:"Yes,No" }}</td>
                            <td>{{ store.delivery_car|yesno:"Yes,No" }}</td>
                            <td>{{ store.delivery_pickup|yesno:"Yes,No" }}</td>

                            <!-- Monday -->
                            <td>{{ store.open_monday|yesno:"<span class='text-success'>Yes</span>,—" }}</td>
                            <td>{{ store.open_time_monday|default:"—" }}</td>
                            <td>{{ store.close_time_monday|default:"—" }}</td>
                               <td>{{ store.close_monday|yesno:"Closed,—" }}</td>

                            <!-- Tuesday -->
                            <td>{{ store.open_tuesday|yesno:"<span class='text-success'>Yes</span>,—" }}</td>
                            <td>{{ store.open_time_tuesday|default:"—" }}</td>
                            <td>{{ store.close_time_tuesday|default:"—" }}</td>
                                <td>{{ store.close_tuesday|yesno:"Closed,—" }}</td>

                            <!-- Wednesday -->
                            <td>{{ store.open_wednesday|yesno:"<span class='text-success'>Yes</span>,—" }}</td>
                            <td>{{ store.open_time_wednesday|default:"—" }}</td>
                            <td>{{ store.close_time_wednesday|default:"—" }}</td>
                               <td>{{ store.close_wednesday|yesno:"Closed,—" }}</td>

                            <!-- Thursday -->
                            <td>{{ store.open_thursday|yesno:"<span class='text-success'>Yes</span>,—" }}</td>
                            <td>{{ store.open_time_thursday|default:"—" }}</td>
                            <td>{{ store.close_time_thursday|default:"—" }}</td>
                                <td>{{ store.close_thursday|yesno:"Closed,—" }}</td>

                            <!-- Friday -->
                            <td>{{ store.open_friday|yesno:"<span class='text-success'>Yes</span>,—" }}</td>
                            <td>{{ store.open_time_friday|default:"—" }}</td>
                            <td>{{ store.close_time_friday|default:"—" }}</td>
                               <td>{{ store.close_friday|yesno:"Closed,—" }}</td>

                            <!-- Saturday -->
                            <td>{{ store.open_saturday|yesno:"<span class='text-success'>Yes</span>,—" }}</td>
                            <td>{{ store.open_time_saturday|default:"—" }}</td>
                            <td>{{ store.close_time_saturday|default:"—" }}</td>
                                <td>{{ store.close_saturday|yesno:"Closed,—" }}</td>

                            <!-- Sunday -->
                            <td>{{ store.open_sunday|yesno:"<span class='text-success'>Yes</span>,—" }}</td>
                            <td>{{ store.open_time_sunday|default:"—" }}</td>
                            <td>{{ store.close_time_sunday|default:"—" }}</td>
                               <td>{{ store.close_sunday|yesno:"Closed,—" }}</td>

                            <!-- Rental Terms -->
                            <td>{{ store.rental_period|default:"—" }}</td>
                            <td class="fw-medium">${{ store.rental_price|default:"0.00" }}</td>
                            <td>${{ store.late_fee|default:"0.00" }}</td>
                            <td>${{ store.security_deposit|default:"0.00" }}</td>
                            <td>{{ store.max_books|default:"—" }}</td>
                            <td>{{ store.discount_percent|default:"0" }}%</td>
                            <td class="text-start">{{ store.payment_methods|default:"—" }}</td>
                                     <td>{{ store.agree_terms|yesno:"<span class='text-success'>Yes</span>,No" }}</td>

                            <td class="text-nowrap">
                                <a href="{% url 'edit_store' store.id %}" class="btn btn-outline-primary btn-sm me-2">
                                    <i class="far fa-edit"></i>edit
                                </a>
                                <form action="{% url 'delete_store' store.id %}" method="post" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-outline-danger btn-sm"
                                            onclick="return confirm('Delete this store permanently?');">
                                        <i class="far fa-trash-alt"></i>delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="70" class="text-center py-5 text-muted fs-5">
                                <i class="fas fa-store-slash me-2"></i>No stores found.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

{% endblock %}