{% extends 'base.html' %}
{% load static %}

{% block title %}Register Your Book Store - BookHub Ethiopia{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-blue: #1e40af;
        --secondary-blue: #3b82f6;
        --light-blue: #dbeafe;
        --accent-blue: #60a5fa;
        --dark-blue: #1e3a8a;
        --success-green: #10b981;
        --warning-orange: #f59e0b;
        --error-red: #ef4444;
        --gray-50: #f8fafc;
        --gray-100: #f1f5f9;
        --gray-200: #e2e8f0;
        --gray-300: #cbd5e1;
        --gray-600: #475569;
        --gray-700: #334155;
        --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
        --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
        --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
        --shadow-xl: 0 20px 40px rgba(0,0,0,0.2);
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .registration-container {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
        min-height: 100vh;
        padding: 30px 0;
        position: relative;
        overflow-x: hidden;
    }

    .registration-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(255,255,255,0.05) 0%, transparent 50%);
        pointer-events: none;
    }

    .registration-card {
        background: white;
        border-radius: 24px;
        box-shadow: var(--shadow-xl);
        overflow: hidden;
        position: relative;
        z-index: 1;
        margin: 20px 0;
    }

    .registration-header {
        background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
        color: white;
        padding: 40px 30px;
        text-align: center;
        position: relative;
    }

    .registration-header::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(to right, var(--success-green), var(--accent-blue));
    }

    .ethiopia-flag {
        font-size: 64px;
        margin-bottom: 20px;
        display: inline-block;
        filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-10px) rotate(2deg); }
    }

    .header-title {
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 10px;
        background: linear-gradient(to right, #ffffff, var(--light-blue));
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .header-subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.6;
    }

    /* Progress Steps */
    .progress-container {
        padding: 30px;
        background: var(--gray-50);
        border-bottom: 1px solid var(--gray-200);
    }

    .steps {
        display: flex;
        justify-content: space-between;
        position: relative;
        margin: 0 40px;
    }

    .steps::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 40px;
        right: 40px;
        height: 3px;
        background: var(--gray-300);
        transform: translateY(-50%);
        z-index: 1;
    }

    .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 2;
    }

    .step-circle {
        width: 60px;
        height: 60px;
        background: white;
        border: 3px solid var(--gray-300);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 20px;
        color: var(--gray-600);
        margin-bottom: 12px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: var(--shadow-sm);
    }

    .step.active .step-circle {
        background: linear-gradient(135deg, var(--secondary-blue), var(--primary-blue));
        color: white;
        border-color: var(--secondary-blue);
        transform: scale(1.1);
        box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
    }

    .step.completed .step-circle {
        background: linear-gradient(135deg, var(--success-green), #34d399);
        color: white;
        border-color: var(--success-green);
    }

    .step.completed .step-circle::after {
        content: '‚úì';
        font-size: 24px;
    }

    .step-label {
        font-size: 14px;
        font-weight: 600;
        color: var(--gray-600);
        text-align: center;
        max-width: 120px;
        line-height: 1.4;
    }

    .step.active .step-label {
        color: var(--primary-blue);
        transform: translateY(2px);
    }

    /* Form Sections */
    .form-section {
        padding: 40px;
        display: none;
        animation: fadeInUp 0.5s ease-out;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .form-section.active {
        display: block;
    }

    .section-header {
        display: flex;
        align-items: flex-start;
        gap: 20px;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--gray-200);
    }

    .section-icon {
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, var(--light-blue), #bfdbfe);
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        color: var(--primary-blue);
        flex-shrink: 0;
    }

    .section-content {
        flex: 1;
    }

    .section-title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--gray-700);
        margin: 0 0 8px 0;
        line-height: 1.2;
    }

    .section-subtitle {
        color: var(--gray-600);
        font-size: 1.1rem;
        line-height: 1.6;
        margin: 0;
    }

    /* Form Elements */
    .form-group {
        margin-bottom: 32px;
        position: relative;
    }

    .form-label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 12px;
        font-size: 15px;
    }

    .form-label i {
        color: var(--secondary-blue);
        font-size: 18px;
    }

    .required-field::after {
        content: "*";
        color: var(--error-red);
        margin-left: 4px;
    }

    .form-control, .form-select {
        width: 100%;
        padding: 16px 20px;
        font-size: 16px;
        line-height: 1.5;
        color: var(--gray-700);
        background-color: white;
        border: 2px solid var(--gray-300);
        border-radius: 12px;
        transition: all 0.3s ease;
        font-family: inherit;
    }

    .form-control:focus, .form-select:focus {
        outline: none;
        border-color: var(--secondary-blue);
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
        transform: translateY(-1px);
    }

    .form-control.is-invalid {
        border-color: var(--error-red);
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23ef4444' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='12' y1='8' x2='12' y2='12'%3E%3C/line%3E%3Cline x1='12' y1='16' x2='12.01' y2='16'%3E%3C/line%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 16px center;
        background-size: 20px;
        padding-right: 48px;
    }

    .form-control.is-valid {
        border-color: var(--success-green);
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2310b981' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M22 11.08V12a10 10 0 1 1-5.93-9.14'%3E%3C/path%3E%3Cpolyline points='22 4 12 14.01 9 11.01'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 16px center;
        background-size: 20px;
        padding-right: 48px;
    }

    .input-with-icon {
        position: relative;
    }

    .input-icon {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-600);
        font-size: 20px;
        z-index: 1;
    }

    .input-with-icon .form-control {
        padding-left: 56px;
    }

    /* Error Messages */
    .error-message {
        display: none;
        align-items: center;
        gap: 8px;
        color: var(--error-red);
        font-size: 14px;
        margin-top: 8px;
        padding: 8px 12px;
        background: #fef2f2;
        border-radius: 8px;
        border-left: 4px solid var(--error-red);
    }

    .error-message.show {
        display: flex;
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(-10px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .error-message i {
        flex-shrink: 0;
    }

    /* Phone Input */
    .phone-input-group {
        display: flex;
        gap: 16px;
        align-items: stretch;
    }

    .country-code-select {
        flex: 0 0 180px;
        background: linear-gradient(to bottom, var(--gray-50), var(--gray-100));
        border: 2px solid var(--gray-300);
        border-radius: 12px;
        padding: 16px;
        font-weight: 600;
        color: var(--gray-700);
        font-size: 16px;
        transition: all 0.3s;
    }

    .country-code-select:focus {
        border-color: var(--secondary-blue);
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
    }

    .ethiopian-flag {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 6px 16px;
        background: linear-gradient(135deg, #da1212, #f8d210, #078930);
        color: white;
        border-radius: 24px;
        font-weight: 600;
        font-size: 15px;
        box-shadow: var(--shadow-sm);
    }

    /* Service Cards */
    .service-cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 24px;
        margin-bottom: 40px;
    }

    .service-card {
        background: white;
        border: 2px solid var(--gray-200);
        border-radius: 18px;
        padding: 28px 24px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .service-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(to right, var(--secondary-blue), var(--primary-blue));
        transform: scaleX(0);
        transition: transform 0.3s;
    }

    .service-card:hover {
        border-color: var(--secondary-blue);
        transform: translateY(-6px);
        box-shadow: var(--shadow-lg);
    }

    .service-card:hover::before {
        transform: scaleX(1);
    }

    .service-card.active {
        border-color: var(--secondary-blue);
        background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(59, 130, 246, 0.15);
    }

    .service-card.active::before {
        transform: scaleX(1);
    }

    .service-icon {
        font-size: 56px;
        margin-bottom: 20px;
        display: block;
        transition: all 0.3s;
    }

    .service-card.active .service-icon {
        transform: scale(1.1);
    }

    .service-title {
        font-size: 20px;
        font-weight: 700;
        color: var(--gray-700);
        margin-bottom: 10px;
    }

    .service-description {
        color: var(--gray-600);
        font-size: 15px;
        line-height: 1.5;
        margin: 0;
    }

    /* Store Hours Card */
    .store-hours-card {
        background: white;
        border-radius: 18px;
        border: 2px solid var(--gray-200);
        padding: 32px;
        margin-bottom: 40px;
        transition: all 0.3s;
    }

    .store-hours-card:hover {
        border-color: var(--secondary-blue);
        box-shadow: var(--shadow-md);
    }

    .store-hours-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }

    .store-hours-table th {
        background: linear-gradient(to bottom, var(--gray-50), var(--gray-100));
        padding: 18px 20px;
        text-align: left;
        font-weight: 600;
        color: var(--gray-700);
        border-bottom: 2px solid var(--gray-200);
        font-size: 15px;
    }

    .store-hours-table td {
        padding: 20px;
        border-bottom: 1px solid var(--gray-100);
        transition: background-color 0.2s;
    }

    .store-hours-table tr:hover td {
        background: var(--gray-50);
    }

    /* Terms Card */
    .terms-card {
        background: linear-gradient(135deg, var(--gray-50), var(--gray-100));
        border-radius: 18px;
        padding: 32px;
        margin-bottom: 32px;
        border: 2px solid var(--gray-200);
    }

    .terms-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 24px;
    }

    .terms-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--secondary-blue), var(--primary-blue));
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 28px;
        flex-shrink: 0;
    }

    .terms-content {
        max-height: 300px;
        overflow-y: auto;
        padding-right: 16px;
    }

    .terms-content::-webkit-scrollbar {
        width: 8px;
    }

    .terms-content::-webkit-scrollbar-track {
        background: var(--gray-100);
        border-radius: 4px;
    }

    .terms-content::-webkit-scrollbar-thumb {
        background: var(--gray-300);
        border-radius: 4px;
    }

    .terms-content::-webkit-scrollbar-thumb:hover {
        background: var(--gray-400);
    }

    /* Currency Input */
    .currency-input-group {
        display: flex;
        border-radius: 12px;
        overflow: hidden;
        border: 2px solid var(--gray-300);
        transition: all 0.3s;
    }

    .currency-input-group:focus-within {
        border-color: var(--secondary-blue);
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
    }

    .currency-symbol {
        padding: 0 24px;
        background: linear-gradient(to bottom, var(--gray-50), var(--gray-100));
        color: var(--gray-700);
        font-weight: 600;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 80px;
        border-right: 2px solid var(--gray-300);
    }

    .et-birr {
        color: var(--primary-blue);
        font-weight: 700;
    }

    .currency-input-group .form-control {
        border: none;
        box-shadow: none;
        border-radius: 0;
    }

    /* Navigation Buttons */
    .navigation-buttons {
        display: flex;
        justify-content: space-between;
        padding: 32px;
        background: var(--gray-50);
        border-top: 1px solid var(--gray-200);
        gap: 16px;
    }

    .btn {
        padding: 18px 40px;
        font-size: 16px;
        font-weight: 600;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        font-family: inherit;
        min-width: 160px;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--secondary-blue), var(--primary-blue));
        color: white;
        box-shadow: 0 8px 20px rgba(37, 99, 235, 0.2);
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 30px rgba(37, 99, 235, 0.3);
    }

    .btn-primary:active {
        transform: translateY(-1px);
    }

    .btn-secondary {
        background: white;
        color: var(--gray-600);
        border: 2px solid var(--gray-300);
    }

    .btn-secondary:hover {
        border-color: var(--secondary-blue);
        color: var(--secondary-blue);
        background: var(--gray-50);
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }

    .btn i {
        font-size: 20px;
    }

    /* Success Badge */
    .success-badge {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 10px 20px;
        background: linear-gradient(135deg, var(--success-green), #34d399);
        color: white;
        border-radius: 24px;
        font-weight: 600;
        font-size: 15px;
        margin-left: 16px;
        box-shadow: var(--shadow-sm);
    }

    /* Info Card */
    .info-card {
        background: linear-gradient(135deg, #e0f2fe, #bae6fd);
        border: 2px solid #7dd3fc;
        border-radius: 18px;
        padding: 28px;
        margin-bottom: 32px;
    }

    .info-card-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 16px;
    }

    .info-card-icon {
        color: #0369a1;
        font-size: 32px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .registration-header {
            padding: 30px 20px;
        }
        
        .header-title {
            font-size: 2rem;
        }
        
        .steps {
            margin: 0 20px;
        }
        
        .steps::before {
            left: 20px;
            right: 20px;
        }
        
        .step-circle {
            width: 50px;
            height: 50px;
            font-size: 18px;
        }
        
        .form-section {
            padding: 30px 20px;
        }
        
        .section-header {
            flex-direction: column;
            gap: 16px;
        }
        
        .section-icon {
            width: 60px;
            height: 60px;
            font-size: 28px;
        }
        
        .service-cards-grid {
            grid-template-columns: 1fr;
        }
        
        .phone-input-group {
            flex-direction: column;
            gap: 12px;
        }
        
        .country-code-select {
            flex: 0 0 auto;
        }
        
        .navigation-buttons {
            padding: 24px 20px;
            flex-direction: column;
        }
        
        .btn {
            width: 100%;
            min-width: auto;
        }
    }

    @media (max-width: 480px) {
        .store-hours-table {
            display: block;
            overflow-x: auto;
        }
        
        .section-title {
            font-size: 1.8rem;
        }
        
        .registration-card {
            margin: 10px;
        }
    }

    /* Helper Text */
    .helper-text {
        display: block;
        color: var(--gray-600);
        font-size: 14px;
        margin-top: 8px;
        line-height: 1.5;
    }

    /* Loading State */
    .btn.loading {
        position: relative;
        color: transparent;
    }

    .btn.loading::after {
        content: '';
        position: absolute;
        width: 24px;
        height: 24px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }
</style>
{% endblock %}

{% block content %}
<div class="registration-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12">
                <div class="registration-card">
                    
                    <!-- Header -->
                    <div class="registration-header">
                        <span class="ethiopia-flag">üá™üáπ</span>
                        <h1 class="header-title">Open Your Book Store</h1>
                        <p class="header-subtitle">Join Ethiopia's premier book sharing platform and connect with readers across the country</p>
                    </div>
                    
                    <!-- Progress Steps -->
                    <div class="progress-container">
                        <div class="steps">
                            <div class="step active" data-step="1">
                                <div class="step-circle">1</div>
                                <span class="step-label">Store Details</span>
                            </div>
                            <div class="step" data-step="2">
                                <div class="step-circle">2</div>
                                <span class="step-label">Services</span>
                            </div>
                            <div class="step" data-step="3">
                                <div class="step-circle">3</div>
                                <span class="step-label">Policies</span>
                            </div>
                            <div class="step" data-step="4">
                                <div class="step-circle">4</div>
                                <span class="step-label">Account</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Registration Form -->
                    <form method="POST" action="{% url 'edit_store' store.id %}" id="storeRegistrationForm" enctype="multipart/form-data" novalidate>
                        {% csrf_token %}
                        
                        <!-- Step 1: Store & Owner Information -->
                        <div class="form-section active" id="step1">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-shop"></i>
                                </div>
                                <div class="section-content">
                                    <h2 class="section-title">Store Information</h2>
                                    <p class="section-subtitle">Tell us about your bookstore and contact details</p>
                                </div>
                            </div>
                            
                            <!-- Store Name -->
                            <div class="form-group">
                                <label for="store_name" class="form-label required-field">
                                    <i class="bi bi-building"></i>
                                    Store Name
                                </label>
                                <div class="input-with-icon">
                                    <i class="bi bi-shop input-icon"></i>
                                    <input type="text" 
                                           class="form-control" 
                                           id="store_name" 
                                           name="store_name"
                                           placeholder="e.g., Addis Book House" 
                                           required   
                                           value="{{ store.store_name|default:'' }}">
                                </div>
                                <span class="helper-text">Choose a memorable name for your bookstore</span>
                                <div class="error-message" id="store_name_error">
                                    <i class="bi bi-exclamation-circle"></i>
                                    <span></span>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="owner_name" class="form-label required-field">
                                            <i class="bi bi-person"></i>
                                            Owner Full Name
                                        </label>
                                        <div class="input-with-icon">
                                            <i class="bi bi-person input-icon"></i>
                                            <input type="text" 
                                                   class="form-control" 
                                                   id="owner_name" 
                                                   name="owner_full_name"
                                                   placeholder="e.g., Selamawit Abebe" 
                                                   required   
                                                   value="{{ store.owner_full_name|default:'' }}">
                                        </div>
                                        <div class="error-message" id="owner_name_error">
                                            <i class="bi bi-exclamation-circle"></i>
                                            <span></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="email" class="form-label required-field">
                                            <i class="bi bi-envelope"></i>
                                            Email Address
                                        </label>
                                        <div class="input-with-icon">
                                            <i class="bi bi-envelope input-icon"></i>
                                            <input type="email" 
                                                   class="form-control" 
                                                   id="email" 
                                                   name="email"
                                                   placeholder="contact@yourbookstore.com" 
                                                   required 
                                                   value="{{ store.email|default:'' }}">
                                        </div>
                                        <div class="error-message" id="email_error">
                                            <i class="bi bi-exclamation-circle"></i>
                                            <span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Phone Number -->
                            <div class="form-group">
                                <label for="phone" class="form-label required-field">
                                    <i class="bi bi-phone"></i>
                                    Phone Number
                                </label>
                                <div class="phone-input-group">
                                    <select class="form-select country-code-select" name="country_code" id="country_code" required>
                                        <option value="+251" selected>
                                            <span class="ethiopian-flag">
                                                üá™üáπ +251
                                            </span>
                                        </option>
                                        <option value="+1">üá∫üá∏ +1 (USA)</option>
                                        <option value="+44">üá¨üáß +44 (UK)</option>
                                        <option value="+91">üáÆüá≥ +91 (India)</option>
                                    </select>
                                    <div class="input-with-icon" style="flex: 1;">
                                        <i class="bi bi-phone input-icon"></i>
                                        <input type="tel" 
                                               class="form-control" 
                                               id="phone" 
                                               name="phone"
                                               pattern="[0-9]{9}"
                                               placeholder="911223344" 
                                               required
                                               value="{{ store.phone|default:'' }}"
                                               oninput="formatEthiopianPhone(this)">
                                    </div>
                                </div>
                                <span class="helper-text">Enter your 9-digit Ethiopian mobile number</span>
                                <div class="error-message" id="phone_error">
                                    <i class="bi bi-exclamation-circle"></i>
                                    <span></span>
                                </div>
                            </div>
                            
                            <!-- Store Type -->
                            <div class="form-group">
                                <label for="store_type" class="form-label required-field">
                                    <i class="bi bi-tag"></i>
                                    Store Type
                                </label>
                                <select class="form-select" id="store_type" name="store_type" required>
                                    <option value="">Select your store type</option>
                                    <option value="bookstore" {% if store.store_type == 'bookstore' %}selected{% endif %}>üìö Traditional Book Store</option>
                                    <option value="library" {% if store.store_type == 'library' %}selected{% endif %}>üèõÔ∏è Library & Reading Space</option>
                                    <option value="coffee_shop" {% if store.store_type == 'coffee_shop' %}selected{% endif %}>‚òï Coffee Shop with Books</option>
                                    <option value="educational" {% if store.store_type == 'educational' %}selected{% endif %}>üéì Educational & Textbook Store</option>
                                    <option value="online_only" {% if store.store_type == 'online_only' %}selected{% endif %}>üíª Online Book Store</option>
                                    <option value="home_based" {% if store.store_type == 'home_based' %}selected{% endif %}>üè† Home-based Book Business</option>
                                    <option value="religious" {% if store.store_type == 'religious' %}selected{% endif %}>üïå Religious Book Store</option>
                                    <option value="children" {% if store.store_type == 'children' %}selected{% endif %}>üß∏ Children's Book Store</option>
                                </select>
                                <div class="error-message" id="store_type_error">
                                    <i class="bi bi-exclamation-circle"></i>
                                    <span></span>
                                </div>
                            </div>
                            
                            <!-- Location -->
                            <div class="info-card">
                                <div class="info-card-header">
                                    <i class="bi bi-geo-alt-fill info-card-icon"></i>
                                    <h5 class="mb-0" style="color: #0369a1;">Store Location</h5>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="city" class="form-label required-field">City</label>
                                            <select class="form-select" id="city" name="city" required>
                                                <option value="">Select your city</option>
                                                <option value="addis_ababa" {% if store.city == 'addis_ababa' %}selected{% endif %}>Addis Ababa (·ä†·ã≤·àµ ·ä†·â†·â£)</option>
                                                <option value="dire_dawa" {% if store.city == 'dire_dawa' %}selected{% endif %}>Dire Dawa (·ãµ·à¨ ·ã≥·ãã)</option>
                                                <option value="bahir_dar" {% if store.city == 'bahir_dar' %}selected{% endif %}>Bahir Dar (·â£·àï·à≠ ·ã≥·à≠)</option>
                                                <option value="mekele" {% if store.city == 'mekele' %}selected{% endif %}>Mekele (·àò·âÄ·àå)</option>
                                                <option value="hawassa" {% if store.city == 'hawassa' %}selected{% endif %}>Hawassa (·àÄ·ãã·à≥)</option>
                                                <option value="gondar" {% if store.city == 'gondar' %}selected{% endif %}>Gondar (·åé·äï·ã∞·à≠)</option>
                                                <option value="jimma" {% if store.city == 'jimma' %}selected{% endif %}>Jimma (·åÖ·àõ)</option>
                                                <option value="desse" {% if store.city == 'desse' %}selected{% endif %}>Dessie (·ã∞·à¥)</option>
                                                <option value="harar" {% if store.city == 'harar' %}selected{% endif %}>Harar (·àê·à®·à≠)</option>
                                                <option value="adama" {% if store.city == 'adama' %}selected{% endif %}>Adama (·ä†·ã≥·àõ)</option>
                                                <option value="jijiga" {% if store.city == 'jijiga' %}selected{% endif %}>Jijiga (·åÖ·åÖ·åã)</option>
                                                <option value="shashamane" {% if store.city == 'shashamane' %}selected{% endif %}>Shashamane (·àª·à∏·àò·äî)</option>
                                                <option value="arba_minch" {% if store.city == 'arba_minch' %}selected{% endif %}>Arba Minch (·ä†·à≠·â£ ·àù·äï·å≠)</option>
                                                <option value="other" {% if store.city == 'other' %}selected{% endif %}>Other City</option>
                                            </select>
                                            <div class="error-message" id="city_error">
                                                <i class="bi bi-exclamation-circle"></i>
                                                <span></span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="subcity" class="form-label">Subcity / Woreda</label>
                                            <input type="text" 
                                                   class="form-control" 
                                                   id="subcity" 
                                                   name="subcity"
                                                   placeholder="e.g., Bole, Kirkos, Piazza"
                                                   value="{{ store.subcity|default:'' }}">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="address" class="form-label required-field">Street Address</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="address" 
                                           name="address"
                                           placeholder="e.g., Bole Road, Near Edna Mall" 
                                           required
                                           value="{{ store.address|default:'' }}">
                                    <div class="error-message" id="address_error">
                                        <i class="bi bi-exclamation-circle"></i>
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Store Description -->
                            <div class="form-group">
                                <label for="store_description" class="form-label">
                                    <i class="bi bi-card-text"></i>
                                    Store Description (Optional)
                                </label>
                                <textarea class="form-control" 
                                          id="store_description" 
                                          name="store_description"
                                          rows="4"
                                          placeholder="Describe your store in English or Amharic...">{{ store.store_description|default:'' }}</textarea>
                                <span class="helper-text">Tell customers what makes your bookstore special</span>
                            </div>
                        </div>
                        
                        <!-- Step 2: Services & Hours -->
                        <div class="form-section" id="step2">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-gear"></i>
                                </div>
                                <div class="section-content">
                                    <h2 class="section-title">Services & Business Hours</h2>
                                    <p class="section-subtitle">Choose services you offer and set your operating hours</p>
                                </div>
                            </div>
                            
                            <!-- Services Offered -->
                            <div class="mb-5">
                                <h5 class="mb-4" style="color: var(--gray-700); font-size: 1.3rem;">Services Offered</h5>
                                <div class="service-cards-grid">
                                    <div class="service-card active" data-service="rental">
                                        <div class="service-icon">üìö</div>
                                        <h5 class="service-title">Book Rentals</h5>
                                        <p class="service-description">·àõ·àª·à∏·ã´ ·àò·åΩ·àÉ·çç·âµ</p>
                                        <input type="checkbox" name="offers_rental" class="d-none" checked>
                                    </div>
                                    <div class="service-card active" data-service="sale">
                                        <div class="service-icon">üí∞</div>
                                        <h5 class="service-title">Book Sales</h5>
                                        <p class="service-description">·ã®·àò·åΩ·àÉ·çç ·àΩ·ã´·å≠</p>
                                        <input type="checkbox" name="offers_sale" class="d-none" checked>
                                    </div>
                                    <div class="service-card active" data-service="delivery">
                                        <div class="service-icon">üõµ</div>
                                        <h5 class="service-title">Home Delivery</h5>
                                        <p class="service-description">·ãà·ã∞ ·â§·âµ ·ä†·âÖ·à≠·â¶·âµ</p>
                                        <input type="checkbox" name="offers_delivery" class="d-none" checked>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Delivery Settings -->
                            <div class="store-hours-card">
                                <h5 class="mb-4" style="color: var(--gray-700); font-size: 1.3rem;">Delivery Settings</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="delivery_radius" class="form-label">Delivery Radius</label>
                                            <div class="input-group">
                                                <input type="number" 
                                                       class="form-control" 
                                                       id="delivery_radius" 
                                                       name="delivery_radius"
                                                       min="1" 
                                                       max="50"
                                                       value="{{ store.delivery_radius|default:'10' }}">
                                                <span class="input-group-text">km</span>
                                            </div>
                                            <span class="helper-text">Kilometers from your store</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="delivery_fee" class="form-label">Delivery Fee</label>
                                            <div class="currency-input-group">
                                                <span class="currency-symbol">
                                                    <span class="et-birr">·â•·à≠</span>
                                                </span>
                                                <input type="number" 
                                                       class="form-control" 
                                                       id="delivery_fee" 
                                                       name="delivery_fee"
                                                       min="0" 
                                                       step="10"
                                                       value="{{ store.delivery_fee|default:'50' }}">
                                            </div>
                                            <span class="helper-text">Fee in Ethiopian Birr</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group mt-4">
                                    <label class="form-label">Delivery Methods</label>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" 
                                                       type="checkbox" 
                                                       id="delivery_bike" 
                                                       name="delivery_methods"
                                                       value="bike"
                                                       {% if 'bike' in store.delivery_methods %}checked{% endif %}>
                                                <label class="form-check-label" for="delivery_bike">
                                                    üõµ Bike Delivery
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" 
                                                       type="checkbox" 
                                                       id="delivery_car" 
                                                       name="delivery_methods"
                                                       value="car"
                                                       {% if 'car' in store.delivery_methods %}checked{% endif %}>
                                                <label class="form-check-label" for="delivery_car">
                                                    üöó Car Delivery
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" 
                                                       type="checkbox" 
                                                       id="delivery_pickup" 
                                                       name="delivery_methods"
                                                       value="pickup"
                                                       {% if 'pickup' in store.delivery_methods %}checked{% endif %}>
                                                <label class="form-check-label" for="delivery_pickup">
                                                    üìç Store Pickup
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Business Hours -->
                            <div class="store-hours-card">
                                <h5 class="mb-4" style="color: var(--gray-700); font-size: 1.3rem;">Business Hours (Ethiopian Time)</h5>
                                <div class="table-responsive">
                                    <table class="store-hours-table">
                                        <thead>
                                            <tr>
                                                <th>Day</th>
                                                <th>Open</th>
                                                <th>Opening Time</th>
                                                <th>Closing Time</th>
                                                <th>Closed</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><strong>Monday</strong></td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="open_monday" 
                                                               id="open_monday" 
                                                               {% if store.open_monday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="open_time_monday"
                                                           value="{{ store.open_time_monday|default:'08:30' }}">
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="close_time_monday"
                                                           value="{{ store.close_time_monday|default:'20:30' }}">
                                                </td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="closed_monday"
                                                               id="closed_monday"
                                                               {% if store.closed_monday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><strong>Tuesday</strong></td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="open_tuesday" 
                                                               id="open_tuesday" 
                                                               {% if store.open_tuesday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="open_time_tuesday"
                                                           value="{{ store.open_time_tuesday|default:'08:30' }}">
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="close_time_tuesday"
                                                           value="{{ store.close_time_tuesday|default:'20:30' }}">
                                                </td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="closed_tuesday"
                                                               id="closed_tuesday"
                                                               {% if store.closed_tuesday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><strong>Wednesday</strong></td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="open_wednesday" 
                                                               id="open_wednesday" 
                                                               {% if store.open_wednesday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="open_time_wednesday"
                                                           value="{{ store.open_time_wednesday|default:'08:30' }}">
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="close_time_wednesday"
                                                           value="{{ store.close_time_wednesday|default:'20:30' }}">
                                                </td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="closed_wednesday"
                                                               id="closed_wednesday"
                                                               {% if store.closed_wednesday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><strong>Thursday</strong></td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="open_thursday" 
                                                               id="open_thursday" 
                                                               {% if store.open_thursday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="open_time_thursday"
                                                           value="{{ store.open_time_thursday|default:'08:30' }}">
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="close_time_thursday"
                                                           value="{{ store.close_time_thursday|default:'20:30' }}">
                                                </td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="closed_thursday"
                                                               id="closed_thursday"
                                                               {% if store.closed_thursday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><strong>Friday</strong></td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="open_friday" 
                                                               id="open_friday" 
                                                               {% if store.open_friday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="open_time_friday"
                                                           value="{{ store.open_time_friday|default:'08:30' }}">
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="close_time_friday"
                                                           value="{{ store.close_time_friday|default:'20:30' }}">
                                                </td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="closed_friday"
                                                               id="closed_friday"
                                                               {% if store.closed_friday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><strong>Saturday</strong></td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="open_saturday" 
                                                               id="open_saturday" 
                                                               {% if store.open_saturday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="open_time_saturday"
                                                           value="{{ store.open_time_saturday|default:'08:30' }}">
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="close_time_saturday"
                                                           value="{{ store.close_time_saturday|default:'20:30' }}">
                                                </td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="closed_saturday"
                                                               id="closed_saturday"
                                                               {% if store.closed_saturday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><strong>Sunday</strong></td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="open_sunday" 
                                                               id="open_sunday"
                                                               {% if store.open_sunday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="open_time_sunday"
                                                           value="{{ store.open_time_sunday|default:'08:30' }}"
                                                           {% if not store.open_sunday %}disabled{% endif %}>
                                                </td>
                                                <td>
                                                    <input type="time" 
                                                           class="form-control" 
                                                           name="close_time_sunday"
                                                           value="{{ store.close_time_sunday|default:'20:30' }}"
                                                           {% if not store.open_sunday %}disabled{% endif %}>
                                                </td>
                                                <td>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" 
                                                               type="checkbox" 
                                                               name="closed_sunday"
                                                               id="closed_sunday"
                                                               {% if store.closed_sunday %}checked{% endif %}>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="alert alert-info mt-4 mb-0">
                                    <i class="bi bi-info-circle me-2"></i>
                                    <small>Note: Most Ethiopian businesses are closed on Sundays. Adjust hours according to your schedule.</small>
                                </div>
                            </div>
                        </div>  
                        
                        <!-- Step 3: Policies -->
                        <div class="form-section" id="step3">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-file-text"></i>
                                </div>
                                <div class="section-content">
                                    <h2 class="section-title">Store Policies</h2>
                                    <p class="section-subtitle">Set your rental policies and pricing in Ethiopian Birr</p>
                                </div>
                            </div>
                            
                            <!-- Rental Policies -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="rental_period" class="form-label required-field">
                                            <i class="bi bi-calendar"></i>
                                            Default Rental Period
                                        </label>
                                        <div class="input-group">
                                            <input type="number" 
                                                   class="form-control" 
                                                   id="rental_period" 
                                                   name="rental_period"
                                                   min="1" 
                                                   max="30"
                                                   value="{{ store.rental_period|default:'7' }}" 
                                                   required>
                                            <span class="input-group-text">days</span>
                                        </div>
                                        <span class="helper-text">Standard rental duration</span>
                                        <div class="error-message" id="rental_period_error">
                                            <i class="bi bi-exclamation-circle"></i>
                                            <span></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="rental_price" class="form-label required-field">
                                            <i class="bi bi-cash-stack"></i>
                                            Rental Price per Day
                                        </label>
                                        <div class="currency-input-group">
                                            <span class="currency-symbol">
                                                <span class="et-birr">·â•·à≠</span>
                                            </span>
                                            <input type="number" 
                                                   class="form-control" 
                                                   id="rental_price" 
                                                   name="rental_price"
                                                   min="0" 
                                                   step="10"
                                                   value="{{ store.rental_price|default:'50' }}" 
                                                   required>
                                        </div>
                                        <span class="helper-text">Daily rental rate in Birr</span>
                                        <div class="error-message" id="rental_price_error">
                                            <i class="bi bi-exclamation-circle"></i>
                                            <span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="late_fee" class="form-label required-field">
                                            <i class="bi bi-clock-history"></i>
                                            Late Fee per Day
                                        </label>
                                        <div class="currency-input-group">
                                            <span class="currency-symbol">
                                                <span class="et-birr">·â•·à≠</span>
                                            </span>
                                            <input type="number" 
                                                   class="form-control" 
                                                   id="late_fee" 
                                                   name="late_fee"
                                                   min="0" 
                                                   step="5"
                                                   value="{{ store.late_fee|default:'20' }}" 
                                                   required>
                                        </div>
                                        <span class="helper-text">Charged for each overdue day</span>
                                        <div class="error-message" id="late_fee_error">
                                            <i class="bi bi-exclamation-circle"></i>
                                            <span></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="security_deposit" class="form-label required-field">
                                            <i class="bi bi-shield-check"></i>
                                            Security Deposit
                                        </label>
                                        <div class="currency-input-group">
                                            <span class="currency-symbol">
                                                <span class="et-birr">·â•·à≠</span>
                                            </span>
                                            <input type="number" 
                                                   class="form-control" 
                                                   id="security_deposit" 
                                                   name="security_deposit"
                                                   min="0" 
                                                   step="50"
                                                   value="{{ store.security_deposit|default:'500' }}" 
                                                   required>
                                        </div>
                                        <span class="helper-text">Refundable deposit for rentals</span>
                                        <div class="error-message" id="security_deposit_error">
                                            <i class="bi bi-exclamation-circle"></i>
                                            <span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Additional Settings -->
                            <div class="store-hours-card">
                                <h5 class="mb-4" style="color: var(--gray-700); font-size: 1.3rem;">Additional Settings</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="max_books" class="form-label">
                                                <i class="bi bi-book"></i>
                                                Max Books per Customer
                                            </label>
                                            <div class="input-group">
                                                <input type="number" 
                                                       class="form-control" 
                                                       id="max_books" 
                                                       name="max_books"
                                                       min="1" 
                                                       value="{{ store.max_books|default:'5' }}">
                                                <span class="input-group-text">books</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="discount_percent" class="form-label">
                                                <i class="bi bi-percent"></i>
                                                Student Discount
                                            </label>
                                            <div class="input-group">
                                                <input type="number" 
                                                       class="form-control" 
                                                       id="discount_percent" 
                                                       name="discount_percent"
                                                       min="0" 
                                                       max="50"
                                                       value="{{ store.discount_percent|default:'10' }}">
                                                <span class="input-group-text">%</span>
                                            </div>
                                            <span class="helper-text">Discount for students with ID</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Payment Methods -->
                            <div class="store-hours-card">
                                <h5 class="mb-4" style="color: var(--gray-700); font-size: 1.3rem;">Accepted Payment Methods</h5>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   id="cash_payment" 
                                                   name="payment_methods"
                                                   value="cash"
                                                   {% if 'cash' in store.payment_methods %}checked{% endif %}>
                                            <label class="form-check-label" for="cash_payment">
                                                üíµ Cash (·â•·à≠)
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   id="telebirr_payment" 
                                                   name="payment_methods"
                                                   value="telebirr"
                                                   {% if 'telebirr' in store.payment_methods %}checked{% endif %}>
                                            <label class="form-check-label" for="telebirr_payment">
                                                üì± Telebirr
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   id="cbe_payment" 
                                                   name="payment_methods"
                                                   value="cbe"
                                                   {% if 'cbe' in store.payment_methods %}checked{% endif %}>
                                            <label class="form-check-label" for="cbe_payment">
                                                üè¶ CBE Birr
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   id="bank_transfer" 
                                                   name="payment_methods"
                                                   value="bank"
                                                   {% if 'bank' in store.payment_methods %}checked{% endif %}>
                                            <label class="form-check-label" for="bank_transfer">
                                                üí≥ Bank Transfer
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Terms & Conditions -->
                            <div class="terms-card">
                                <div class="terms-header">
                                    <div class="terms-icon">
                                        <i class="bi bi-file-earmark-text"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-1">Terms & Conditions</h5>
                                        <small class="text-muted">Please read and agree to continue</small>
                                    </div>
                                </div>
                                
                                <div class="terms-content">
                                    <h6>·ãç·àç ·ä•·äì ·àÅ·äî·â≥·ãé·âΩ (Terms & Conditions)</h6>
                                    <p class="mb-3">By registering your store, you agree to the following terms:</p>
                                    <ol class="mb-3">
                                        <li><strong>Payment Handling:</strong> All transactions are handled offline in Ethiopian Birr. BookHub does not process payments.</li>
                                        <li><strong>Inventory Management:</strong> You are responsible for maintaining accurate and up-to-date book inventory.</li>
                                        <li><strong>Customer Service:</strong> Respond to customer inquiries and orders within 24 hours.</li>
                                        <li><strong>Rental Policies:</strong> Honor the rental periods, prices, and return policies as specified.</li>
                                        <li><strong>Book Condition:</strong> Maintain books in good condition and accurately describe their condition to customers.</li>
                                        <li><strong>Delivery Commitment:</strong> If you offer delivery, provide accurate time estimates and honor delivery commitments.</li>
                                        <li><strong>Legal Compliance:</strong> Comply with Ethiopian copyright laws and regulations regarding book sales and rentals.</li>
                                        <li><strong>Data Privacy:</strong> Protect customer information and only use it for order fulfillment purposes.</li>
                                    </ol>
                                    <p class="mb-0"><strong>·ä†·àµ·çà·àã·åä ·àõ·àµ·â≥·ãà·àª:</strong> BookHub serves as a platform connecting Ethiopian bookstores with readers. All transactions and customer relationships are managed directly between store owners and customers.</p>
                                </div>
                                
                                <div class="form-check mt-4">
                                    <input class="form-check-input" 
                                           type="checkbox" 
                                           id="agree_terms" 
                                           name="agree_terms"
                                           required
                                           {% if store.agree_terms %}checked{% endif %}>
                                    <label class="form-check-label" for="agree_terms">
                                        ‚úÖ I have read and agree to the Terms & Conditions / ·ãç·àé·âΩ·äï ·ä†·äï·â•·â§ ·ä•·âÄ·â†·àã·àà·àÅ
                                    </label>
                                    <div class="error-message" id="agree_terms_error">
                                        <i class="bi bi-exclamation-circle"></i>
                                        <span>You must agree to the terms to continue</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 4: Account Setup -->
                        <div class="form-section" id="step4">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-lock"></i>
                                </div>
                                <div class="section-content">
                                    <h2 class="section-title">Account Setup</h2>
                                    <p class="section-subtitle">Create your login credentials and store profile</p>
                                    <span class="success-badge">
                                        <i class="bi bi-check-circle"></i>
                                        Almost done!
                                    </span>
                                </div>
                            </div>

                            <!-- Success Message -->
                            <div class="info-card">
                                <div class="info-card-header">
                                    <i class="bi bi-rocket-takeoff info-card-icon"></i>
                                    <h5 class="mb-0" style="color: #0369a1;">Ready to Launch Your Store!</h5>
                                </div>
                                <p class="mb-0">Complete your registration to start managing your bookstore online. You'll be able to add books, accept orders, and connect with readers immediately after registration.</p>
                            </div>

                            <!-- Next Steps -->
                            <div class="info-card">
                                <div class="info-card-header">
                                    <i class="bi bi-check-circle info-card-icon"></i>
                                    <h5 class="mb-0" style="color: #0369a1;">What Happens Next?</h5>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <ul class="mb-0">
                                            <li>‚úÖ Instant store profile creation</li>
                                            <li>üìö Start adding books immediately</li>
                                            <li>üõí Accept orders from customers</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <ul class="mb-0">
                                            <li>üì± Manage orders from mobile</li>
                                            <li>üìä View sales analytics</li>
                                            <li>üåü Get listed in local searches</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Navigation Buttons -->
                        <div class="navigation-buttons">
                            <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">
                                <i class="bi bi-arrow-left"></i>
                                Previous
                            </button>
                            <button type="button" class="btn btn-primary" id="nextBtn">
                                Next Step
                                <i class="bi bi-arrow-right"></i>
                            </button>
                            <button type="submit" class="btn btn-primary" id="submitBtn" style="display: none;">
                                <i class="bi bi-check-circle"></i>
                                Complete Registration
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Login Link -->
                <div class="text-center mt-4 text-white">
                    <p class="mb-2">Already have a store account?</p>
                    <a href="{% url 'login' %}" class="btn btn-outline-light btn-lg">
                        <i class="bi bi-box-arrow-in-right me-2"></i>
                        Login to Your Store
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    let currentStep = 1;
    const totalSteps = 4;
    const form = document.getElementById('storeRegistrationForm');
    
    // Initialize password toggles
    initializePasswordToggles();
    
    // Initialize service cards
    initializeServiceCards();
    
    // Initialize business hours toggles
    initializeBusinessHours();
    
    // Initialize step navigation
    initializeStepNavigation();
    
    // Initialize form validation
    initializeFormValidation();
    
    // Initialize form submission
    initializeFormSubmission();
    
    // Initialize auto-slug generation
    initializeAutoSlug();
    
    function initializePasswordToggles() {
        document.querySelectorAll('.password-toggle').forEach(function(toggle) {
            toggle.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const passwordInput = document.getElementById(targetId);
                const icon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.className = 'bi bi-eye-slash';
                } else {
                    passwordInput.type = 'password';
                    icon.className = 'bi bi-eye';
                }
            });
        });
    }
    
    function initializeServiceCards() {
        document.querySelectorAll('.service-card').forEach(function(card) {
            card.addEventListener('click', function() {
                const checkbox = this.querySelector('input[type="checkbox"]');
                checkbox.checked = !checkbox.checked;
                
                if (checkbox.checked) {
                    this.classList.add('active');
                } else {
                    this.classList.remove('active');
                }
            });
            
            // Set initial active state
            const checkbox = card.querySelector('input[type="checkbox"]');
            if (checkbox.checked) {
                card.classList.add('active');
            }
        });
    }
    
    function initializeBusinessHours() {
        // Toggle closed days logic
        document.querySelectorAll('input[name^="closed_"]').forEach(function(checkbox) {
            checkbox.addEventListener('change', function() {
                const day = this.name.split('_')[1];
                const openCheckbox = document.querySelector(`input[name="open_${day}"]`);
                const openTime = document.querySelector(`input[name="open_time_${day}"]`);
                const closeTime = document.querySelector(`input[name="close_time_${day}"]`);
                
                if (this.checked) {
                    openCheckbox.checked = false;
                    openTime.disabled = true;
                    closeTime.disabled = true;
                } else {
                    openTime.disabled = false;
                    closeTime.disabled = false;
                }
            });
        });
        
        // Toggle open/close logic
        document.querySelectorAll('input[name^="open_"]').forEach(function(checkbox) {
            checkbox.addEventListener('change', function() {
                const day = this.name.split('_')[1];
                const closedCheckbox = document.querySelector(`input[name="closed_${day}"]`);
                const openTime = document.querySelector(`input[name="open_time_${day}"]`);
                const closeTime = document.querySelector(`input[name="close_time_${day}"]`);
                
                if (!this.checked) {
                    closedCheckbox.checked = true;
                    openTime.disabled = true;
                    closeTime.disabled = true;
                } else {
                    closedCheckbox.checked = false;
                    openTime.disabled = false;
                    closeTime.disabled = false;
                }
            });
        });
    }
    
    function initializeStepNavigation() {
        // Next button click
        document.getElementById('nextBtn').addEventListener('click', function() {
            if (validateStep(currentStep)) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    showStep(currentStep);
                }
            }
        });
        
        // Previous button click
        document.getElementById('prevBtn').addEventListener('click', function() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        });
    }
    
    function showStep(step) {
        // Hide all steps
        document.querySelectorAll('.form-section').forEach(function(section) {
            section.classList.remove('active');
        });
        
        // Show current step
        document.getElementById(`step${step}`).classList.add('active');
        
        // Update step indicators
        document.querySelectorAll('.step').forEach(function(stepEl) {
            const stepNumber = parseInt(stepEl.getAttribute('data-step'));
            stepEl.classList.remove('active', 'completed');
            
            if (stepNumber === step) {
                stepEl.classList.add('active');
            } else if (stepNumber < step) {
                stepEl.classList.add('completed');
            }
        });
        
        // Update navigation buttons
        document.getElementById('prevBtn').style.display = step === 1 ? 'none' : 'flex';
        document.getElementById('nextBtn').style.display = step === totalSteps ? 'none' : 'flex';
        document.getElementById('submitBtn').style.display = step === totalSteps ? 'flex' : 'none';
        
        // Scroll to top of form
        document.querySelector('.form-section.active').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    function validateStep(step) {
        let isValid = true;
        
        // Clear previous errors
        clearErrors();
        
        // Step 1 validation
        if (step === 1) {
            const requiredFields = ['store_name', 'owner_name', 'email', 'phone', 'city', 'address', 'store_type'];
            
            requiredFields.forEach(function(field) {
                const input = document.getElementById(field);
                const error = document.getElementById(`${field}_error`);
                
                if (!input.value.trim()) {
                    isValid = false;
                    showError(input, error, 'This field is required');
                } else {
                    clearError(input, error);
                    
                    // Email validation
                    if (field === 'email') {
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (!emailRegex.test(input.value)) {
                            isValid = false;
                            showError(input, error, 'Please enter a valid email address');
                        }
                    }
                    
                    // Phone validation
                    if (field === 'phone') {
                        const phoneRegex = /^[0-9]{9}$/;
                        if (!phoneRegex.test(input.value)) {
                            isValid = false;
                            showError(input, error, 'Please enter a valid 9-digit phone number');
                        }
                    }
                }
            });
        }
        
        // Step 3 validation (terms agreement)
        if (step === 3) {
            const agreeTerms = document.getElementById('agree_terms');
            const error = document.getElementById('agree_terms_error');
            
            if (!agreeTerms.checked) {
                isValid = false;
                showError(agreeTerms, error, 'You must agree to the terms and conditions');
            } else {
                clearError(agreeTerms, error);
            }
        }
        
        // Step 4 validation (passwords)
        if (step === 4) {
            const password = document.getElementById('password');
            const confirmPassword = document.getElementById('confirm_password');
            const passwordError = document.getElementById('password_error');
            const confirmError = document.getElementById('confirm_password_error');
            
            // Password validation
            if (password && password.value.length < 8) {
                isValid = false;
                showError(password, passwordError, 'Password must be at least 8 characters');
            } else if (password) {
                clearError(password, passwordError);
            }
            
            // Confirm password validation
            if (confirmPassword && password.value !== confirmPassword.value) {
                isValid = false;
                showError(confirmPassword, confirmError, 'Passwords do not match');
            } else if (confirmPassword) {
                clearError(confirmPassword, confirmError);
            }
        }
        
        return isValid;
    }
    
    function showError(input, errorElement, message) {
        input.classList.add('is-invalid');
        errorElement.querySelector('span').textContent = message;
        errorElement.classList.add('show');
    }
    
    function clearError(input, errorElement) {
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
        errorElement.classList.remove('show');
    }
    
    function clearErrors() {
        document.querySelectorAll('.error-message').forEach(function(error) {
            error.classList.remove('show');
        });
        
        document.querySelectorAll('.form-control, .form-select').forEach(function(input) {
            input.classList.remove('is-invalid', 'is-valid');
        });
    }
    
    function initializeFormValidation() {
        // Real-time validation for required fields
        document.querySelectorAll('[required]').forEach(function(input) {
            input.addEventListener('blur', function() {
                const field = this.id;
                const error = document.getElementById(`${field}_error`);
                
                if (!this.value.trim() && this.hasAttribute('required')) {
                    showError(this, error, 'This field is required');
                } else {
                    clearError(this, error);
                }
            });
        });
        
        // Real-time email validation
        document.getElementById('email').addEventListener('blur', function() {
            const error = document.getElementById('email_error');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (this.value && !emailRegex.test(this.value)) {
                showError(this, error, 'Please enter a valid email address');
            } else if (this.value) {
                clearError(this, error);
            }
        });
        
        // Real-time phone validation
        document.getElementById('phone').addEventListener('blur', function() {
            const error = document.getElementById('phone_error');
            const phoneRegex = /^[0-9]{9}$/;
            
            if (this.value && !phoneRegex.test(this.value)) {
                showError(this, error, 'Please enter a valid 9-digit phone number');
            } else if (this.value) {
                clearError(this, error);
            }
        });
        
        // Real-time password validation (if password fields exist)
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirm_password');
        
        if (password) {
            password.addEventListener('input', function() {
                const error = document.getElementById('password_error');
                const confirmError = document.getElementById('confirm_password_error');
                
                if (this.value.length > 0 && this.value.length < 8) {
                    showError(this, error, 'Password must be at least 8 characters');
                } else if (this.value.length >= 8) {
                    clearError(this, error);
                }
                
                // Update confirm password validation
                if (confirmPassword && confirmPassword.value && this.value !== confirmPassword.value) {
                    showError(confirmPassword, confirmError, 'Passwords do not match');
                } else if (confirmPassword && confirmPassword.value && this.value === confirmPassword.value) {
                    clearError(confirmPassword, confirmError);
                }
            });
        }
        
        if (confirmPassword) {
            // Real-time confirm password validation
            confirmPassword.addEventListener('input', function() {
                const error = document.getElementById('confirm_password_error');
                const password = document.getElementById('password');
                
                if (this.value && password.value !== this.value) {
                    showError(this, error, 'Passwords do not match');
                } else if (this.value && password.value === this.value) {
                    clearError(this, error);
                }
            });
        }
    }
    
    function initializeFormSubmission() {
        form.addEventListener('submit', function(e) {
            // Validate current step before allowing normal form POST
            if (!validateStep(currentStep)) {
                e.preventDefault();
                return;
            }

            // Show loading state and allow form to submit normally to the server
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Saving...';
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            // do not preventDefault() so the browser performs the POST to the server
        });
    }
    
    function initializeAutoSlug() {
        const storeNameInput = document.getElementById('store_name');
        const storeSlugInput = document.getElementById('store_slug');
        
        if (storeNameInput && storeSlugInput) {
            storeNameInput.addEventListener('input', function() {
                if (!storeSlugInput.value) {
                    const slug = this.value
                        .toLowerCase()
                        .replace(/[^a-z0-9\s]/g, '')
                        .replace(/\s+/g, '-')
                        .substring(0, 30);
                    storeSlugInput.value = slug;
                }
            });
        }
        
        // Format Ethiopian phone number
        window.formatEthiopianPhone = function(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value.length > 9) {
                value = value.substring(0, 9);
            }
            
            input.value = value;
        };
    }
    
    // Initialize first step
    showStep(currentStep);
});
</script>
{% endblock %}