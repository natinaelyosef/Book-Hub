{% extends "store/dashboard.html" %}
{% load static %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">Edit Book</h1>
        
        <form method="POST" enctype="multipart/form-data" class="bg-white rounded-lg shadow-lg p-8">
            {% csrf_token %}
            
            <!-- Current Image Display -->
            {% if book.cover_image %}
            <div class="mb-6 text-center">
                <label class="block text-sm font-medium text-gray-700 mb-2">Current Cover Image</label>
                <img src="{{ book.cover_image.url }}" alt="{{ book.title }}" class="max-h-48 mx-auto rounded-lg shadow-md">
            </div>
            {% endif %}
            
            <!-- Image Upload Field -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    {% if book.cover_image %}Update Cover Image{% else %}Upload Cover Image{% endif %}
                </label>
                
                <!-- Image preview for new upload -->
                <div class="border-2 border-dashed border-gray-300 rounded-xl p-4 text-center hover:border-blue-500 transition cursor-pointer mb-3"
                     onclick="document.getElementById('cover_image').click()">
                    <input type="file" name="cover_image" id="cover_image" accept="image/*" class="hidden" onchange="previewNewImage(this)">
                    
                    <div id="new_image_preview" class="hidden mb-3">
                        <img id="new_image_preview_img" src="#" alt="New cover preview" class="max-h-32 mx-auto rounded-lg shadow">
                    </div>
                    
                    <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H8a4 4 0 01-4-4v-20m32 12h-8m-12 0h-8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <p class="mt-1 text-sm text-gray-600">Click to select new image</p>
                </div>
                
                <p class="text-xs text-gray-500">Leave empty to keep current image. PNG, JPG, GIF up to 5MB</p>
            </div>
            
            <!-- Book Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Title *</label>
                    <input type="text" name="title" value="{{ book.title }}" required
                           class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Author *</label>
                    <input type="text" name="author" value="{{ book.author }}" required
                           class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Genre *</label>
                    <select name="genre" required class="w-full px-4 py-3 rounded-xl border border-gray-300">
                        <option value="fiction" {% if book.genre == 'fiction' %}selected{% endif %}>Fiction</option>
                        <option value="non-fiction" {% if book.genre == 'non-fiction' %}selected{% endif %}>Non-Fiction</option>
                        <option value="sci-fi" {% if book.genre == 'sci-fi' %}selected{% endif %}>Science Fiction</option>
                        <option value="fantasy" {% if book.genre == 'fantasy' %}selected{% endif %}>Fantasy</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Publication Year</label>
                    <input type="number" name="publication_year" value="{{ book.publication_year }}"
                           class="w-full px-4 py-3 rounded-xl border border-gray-300">
                </div>
            </div>
            
            <!-- Inventory Details -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Total Copies *</label>
                    <input type="number" name="total_copies" value="{{ book.total_copies }}" required
                           class="w-full px-4 py-3 rounded-xl border border-gray-300">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Available for Rent *</label>
                    <input type="number" name="available_rent" value="{{ book.available_copies }}" required
                           class="w-full px-4 py-3 rounded-xl border border-gray-300">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Available for Sale *</label>
                    <input type="number" name="available_sale" value="{{ book.available_sales }}" required
                           class="w-full px-4 py-3 rounded-xl border border-gray-300">
                </div>
            </div>
            
            <!-- Pricing -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Rental Price ($) *</label>
                    <input type="number" name="rental_price" value="{{ book.rental_price }}" required step="0.01"
                           class="w-full px-4 py-3 rounded-xl border border-gray-300">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Sale Price ($) *</label>
                    <input type="number" name="sale_price" value="{{ book.sale_price }}" required step="0.01"
                           class="w-full px-4 py-3 rounded-xl border border-gray-300">
                </div>
            </div>
            
            <!-- Form Actions -->
            <div class="flex justify-end gap-4 mt-8 pt-6 border-t">
                <button type="button" onclick="window.history.back()" 
                        class="px-6 py-3 rounded-xl border border-gray-300 hover:bg-gray-100 transition">
                    Cancel
                </button>
                <button type="submit" 
                        class="px-6 py-3 rounded-xl bg-blue-600 text-white hover:bg-blue-700 shadow-md transition">
                    Update Book
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function previewNewImage(input) {
    const previewContainer = document.getElementById('new_image_preview');
    const preview = document.getElementById('new_image_preview_img');
    
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            preview.src = e.target.result;
            previewContainer.classList.remove('hidden');
        }
        
        reader.readAsDataURL(input.files[0]);
    }
}
</script>
{% endblock %}